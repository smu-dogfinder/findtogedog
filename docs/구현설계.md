# 함께찾개 – 구현 상세 설계서

본 문서는 모델/데이터/파라미터/추론 절차 등 구현 레벨 기재 문서이다.

---

## 1) 이미지 생성 모델 설계

### Base Model
- Stable Diffusion 1.5 (Realistic Vision)
- Diffusers Image-to-Image pipeline 사용

### LoRA 적용 이유
- SD는 full fine-tuning 비용 매우 큼
- LoRA는 low-rank 가중치만 학습 → 적은 데이터로 품종 특징 반영 가능

### LoRA 학습 데이터
| 품종 | 이미지 수 |
|---|---|
| 진돗개 | 40 |
| 포메라니안 | 32 |
| 푸들 | 54 |

최소 해상도 512×512 이상  
노이즈 / blur / 사람 포함 이미지 제외

### Prompt labeling
- 자동 태깅(Fifth type): Florence-2 / WD 1.4 Tagger 테스트
- 최종 결론: 수동 태깅 + 자동 태깅 조합이 best
- 예시 텍스트:  
`"a white adult pomeranian dog, very fluffy coat, round face, outdoors"`

### 학습 파라미터
| 품종 | lr | step |
|---|---:|---:|
| 진돗개 | 1e-4 | 7000 |
| 포메라니안 | 1e-4 | 7000 |
| 푸들 | 5e-5 | 5000 |

### IP-Adapter 적용 이유
- reference image feature를 반영해 색상/스타일 일관성 ↑
- Scheduler: Karras++ (품질 개선 목적)

---

## 2) 색상 추출 설계

- Segmentation 기반 foreground masking
- K-means clustering → dominant color 1개 추출
- HSV 기준으로 4종 분류  
  White / Black / Brown / Light Brown (회색계열은 white로 통합)

---

## 3) 품종 추출 설계

- YOLOv8 Detection model
- class = dog breed 로 fine-tuned
- Roboflow dataset + google 이미지 병합
- augmentation 후 약 2900 / 210 split로 사용

---

## 4) 검색 Score 설계

`최종 SCORE = (이미지 유사도 × 0.8) + (색상 유사도 × 0.2) + penalty`

- 이미지 유사도: CLIP cosine similarity
- 색상 유사도: CIELAB ΔE
- penalty 예:
  - 품종 mismatch : down weight
  - 색상 mismatch : down weight
- 최소 0.2 이상만 후보로 채택
